from django.db import models
from django.urls import reverse, reverse_lazy

class Target(models.Model):
    name = models.CharField(max_length=64, verbose_name='Name', db_index=True, null=True)
    target_ip = models.GenericIPAddressField(verbose_name="IP", db_index=True)
    notes = models.CharField(max_length=256, verbose_name="Notes", blank=True)
    added_at = models.DateTimeField(auto_now_add=True, verbose_name="Added date")
    report_ready_at = models.DateTimeField(auto_now=True, verbose_name="Ready date")

    def get_absolute_url(self):
        return reverse('view_target', kwargs={"target_id": self.pk})

    def __str__(self):
        if self.name:
            return self.name
        return self.name + self.target_ip

    class Meta:
        verbose_name = "Target"
        verbose_name_plural = "Targets"
        ordering = ['-report_ready_at']



class Report(models.Model):
    target = models.ForeignKey("Target", on_delete=models.CASCADE, db_index=True, verbose_name="Target")
    finish_date = models.DateTimeField(auto_now_add=True, verbose_name="Finish time", null=True)
    notes = models.CharField(max_length=256, verbose_name="Notes", blank=True)
    status = models.BooleanField(default=False, verbose_name="Is ready")
    data = models.FileField(upload_to='reports/%Y/%m/%d/%H', verbose_name="Data", null=True)

    def __str__(self):
        return str(self.target)

    class Meta:
        verbose_name = "Report"
        verbose_name_plural = "Reports"
        ordering = ['-finish_date']


